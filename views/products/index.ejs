<%- contentFor("title", "Products") %>

<%- contentFor("body") %>

<form method="GET">
    <%- searchForm %>
    <button class="btn btn-primary mt-3">Search</button>
</form>

<% if (products && products.length) { %>
  
    <h1>Products</h1>
    <a href="/products/create" class="btn btn-primary">
     Add New Product
    </a>
  
  
    <table class="table mt-3">
      <thead class="table-light">
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th class="text-end">Price</th>          
          <th>Category</th>
          <th>Tags</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(function(product) { %>
          <tr>
            <td><strong><%= product.name %></strong></td>
            <td><%= product.description %></td>
            <td class="text-end">$<%= (product.cost/100).toFixed(2) %></td>         
            <td><%= product.category.name %></td>
            <td>
                <% product.tags.forEach(function(tag) { %>
                    <span class="badge bg-primary"><%= tag.name %></span>
                <% }); %>
            </td>
            <td>
                <a href="/products/<%= product.id %>/update" class="btn btn-primary btn-sm">Update</a>
                <a href="/products/<%= product.id %>/delete" class="btn btn-danger btn-sm">Delete</a>
                <% if (locals.user) { %>
                <form method="POST" action="/cart/product/<%= product.id %>/add" style="display:inline;">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button type="submit" class="btn btn-success btn-sm">Add to Cart</button>
                </form>
                <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  
<% } else { %>
  <div class="text-center py-5">
    <h2>No products found</h2>   
  </div>
<% } %>
